<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>–î–ª—è –ù–∞—Å—Ç—ë–Ω—ã—à–∞ ‚ù§Ô∏è</title>

  <style>
    :root{
      --bg1:#ff4d6d;
      --bg2:#ff8fab;
      --card: rgba(255,255,255,.14);
      --shadow: 0 12px 34px rgba(0,0,0,.28);
      --radius: 18px;
    }

    *{ margin:0; padding:0; box-sizing:border-box; }
    html, body { height: 100%; }
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      min-height: 100svh;
      color: #fff;
      overflow-x: hidden;
      overflow-y: auto;

      background:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='140'%3E%3Cpath d='M70 110 C30 70 30 40 50 35 C60 32 70 42 70 42 C70 42 80 32 90 35 C110 40 110 70 70 110 Z' fill='none' stroke='white' stroke-opacity='0.06' stroke-width='3'/%3E%3C/svg%3E"),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      animation: pulseBg 6s infinite alternate;
    }

    @keyframes pulseBg { from { filter: brightness(1); } to { filter: brightness(1.06); } }

    .screen{
      position: relative;
      min-height: 100svh;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      text-align:center;
      padding: 18px 16px 22px;
      z-index: 2;
      gap: 10px;
    }
    .hidden{ display:none !important; }

    .card{
      width: min(520px, 92vw);
      background: var(--card);
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 22px;
      padding: 16px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }

    h1{ font-size: 26px; line-height: 1.15; }
    h2{ font-size: 22px; line-height: 1.2; }
    p{ line-height: 1.35; }

    button{
      margin-top: 10px;
      padding: 14px 28px;
      font-size: 16px;
      border: none;
      border-radius: 999px;
      background: #fff;
      color: #ff4d6d;
      cursor: pointer;
      box-shadow: 0 10px 22px rgba(0,0,0,.18);
      -webkit-tap-highlight-color: transparent;
    }
    button:active{ transform: translateY(1px); }

    /* –°–ª–∞–π–¥ */
    #slideWrap{
      width: min(520px, 92vw);
      display:flex;
      flex-direction:column;
      align-items:center;
      gap: 12px;
    }

    #slideImage{
      width: 100%;
      max-width: 360px;
      max-height: 52svh;
      object-fit: contain;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      transition: opacity .45s ease;
      opacity: 1;
      background: rgba(255,255,255,.08);
    }
    #slideImage.fade{ opacity: 0; }

    .text{
      font-size: 18px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.12);
      border: 1px solid rgba(255,255,255,.12);
      width: 100%;
    }

    .meta{
      opacity: .85;
      font-size: 14px;
    }

    /* –§–∏–Ω–∞–ª */
    .collage{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      width: min(520px, 92vw);
      margin-top: 10px;
    }
    .collage img{
      width: 100%;
      aspect-ratio: 1 / 1;
      object-fit: cover;
      border-radius: 14px;
      box-shadow: 0 8px 18px rgba(0,0,0,.18);
      cursor: pointer;
    }

    /* –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–æ—Ç–æ */
    .modal{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.72);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10;
      padding: 18px;
    }
    .modal.show{ display:flex; }
    .modal img{
      width: min(92vw, 720px);
      max-height: 86svh;
      object-fit: contain;
      border-radius: 16px;
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
      background: rgba(255,255,255,.06);
    }
    .modal .close{
      position: fixed;
      top: max(14px, env(safe-area-inset-top));
      right: max(14px, env(safe-area-inset-right));
      background: rgba(255,255,255,.92);
      color: #ff4d6d;
      border-radius: 999px;
      padding: 10px 14px;
      font-size: 14px;
      border: none;
    }

    /* –°–µ—Ä–¥–µ—á–∫–∏ —Ñ–æ–Ω–æ–≤—ã–µ */
    .heart{
      position: fixed;
      top: -40px;
      color: #fff;
      opacity: 0.22;
      animation: fall linear forwards;
      z-index: 1;
      pointer-events: none;
      will-change: transform, opacity;
      transform: translate3d(0,0,0);
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.12));
    }
    @keyframes fall{
      to { transform: translate3d(0, 120svh, 0); opacity: 0; }
    }

    /* –°–µ—Ä–¥–µ—á–∫–∏ –ø–æ —Ç–∞–ø—É */
    .tap-heart{
      position: fixed;
      font-size: 22px;
      animation: tapFloat 1.6s forwards;
      pointer-events: none;
      z-index: 3;
      will-change: transform, opacity;
      transform: translate3d(0,0,0);
    }
    @keyframes tapFloat{
      0% { transform: translate3d(0,0,0) scale(.6); opacity: 1; }
      100% { transform: translate3d(0,-80px,0) scale(1.35); opacity: 0; }
    }

    /* –£–≤–∞–∂–µ–Ω–∏–µ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ "—É–º–µ–Ω—å—à–∏—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ" */
    @media (prefers-reduced-motion: reduce){
      body{ animation:none; }
      .heart, .tap-heart{ display:none !important; }
      #slideImage{ transition:none; }
    }
  </style>
</head>

<body>
  <audio id="music" src="music.mp3" preload="auto" playsinline></audio>

  <!-- START -->
  <section class="screen" id="startScreen">
    <div class="card">
      <h1>–î–ª—è —Ç–µ–±—è, –º–æ—è ü¶ä‚ù§Ô∏è</h1>
      <p style="margin-top:10px; opacity:.9">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫ –∏ –Ω–∞—á–∞—Ç—å</p>
      <button id="startBtn" aria-label="–í–∫–ª—é—á–∏—Ç—å –∏ –Ω–∞—á–∞—Ç—å">‚ñ∂ –í–∫–ª—é—á–∏—Ç—å</button>
      <p class="meta" id="hint" style="margin-top:10px;"></p>
    </div>
  </section>

  <!-- SLIDESHOW -->
  <section class="screen hidden" id="slideScreen">
    <div id="slideWrap">
      <img id="slideImage" alt="" />
      <div class="text" id="slideText"></div>
      <div class="meta" id="progress"></div>

      <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center;">
        <button id="toggleSoundBtn" aria-label="–í–∫–ª—é—á–∏—Ç—å –∏–ª–∏ –≤—ã–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫">üîä –ó–≤—É–∫</button>
        <button id="skipBtn" aria-label="–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∫ —Ñ–∏–Ω–∞–ª—É">‚è≠ –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
      </div>
    </div>
  </section>

  <!-- FINAL -->
  <section class="screen hidden" id="finalScreen">
    <div class="card">
      <h2>–° –î–Ω—ë–º –°–≤—è—Ç–æ–≥–æ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞ ‚ù§Ô∏è</h2>
      <p style="margin:10px 0 6px;">–Ø –ª—é–±–ª—é —Ç–µ–±—è, –ù–∞—Å—Ç—ë–Ω—ã—à</p>
      <p style="opacity:.85;">–í–º–µ—Å—Ç–µ —Å 15.01.2026</p>

      <button id="hugBtn">ü§ç –û–±–Ω—è—Ç—å</button>
      <p id="hugText" style="margin-top:12px; font-size:18px;"></p>
    </div>

    <div class="collage" id="collage" aria-label="–ö–æ–ª–ª–∞–∂ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π"></div>

    <p class="meta" style="margin-top:14px; opacity:.8;">
      (–ù–∞–∂–º–∏ –Ω–∞ —Ñ–æ—Ç–æ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å)
    </p>
  </section>

  <!-- MODAL -->
  <div class="modal" id="modal" aria-hidden="true">
    <button class="close" id="closeModalBtn" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
    <img id="modalImg" alt="–§–æ—Ç–æ" />
  </div>

  <script>
    // === –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ª–∞–π–¥–æ–≤ ===
    const slides = [
      { img: "images/photo1.jpg", text: "–ú–æ—è –ê–Ω–∞—Å—Ç–∞—Å–∏—è‚Ä¶" },
      { img: "images/photo2.jpg", text: "–ù–∞—Å—Ç—ë–Ω—ã—à, —Å —Ç–æ–±–æ–π –∫–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –æ—Å–æ–±–µ–Ω–Ω—ã–π" },
      { img: "images/photo3.jpg", text: "–¢—ã ‚Äî –º–æ–π —Å–∞–º—ã–π –ª—é–±–∏–º—ã–π —á–µ–ª–æ–≤–µ–∫" },
      { img: "images/photo4.jpg", text: "–õ–∏—Å—ë–Ω—ã—à, —è –≤–ª—é–±–ª—è—é—Å—å –≤ —Ç–µ–±—è —Å–Ω–æ–≤–∞ –∏ —Å–Ω–æ–≤–∞" },
      { img: "images/photo5.jpg", text: "–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å —É –º–µ–Ω—è" },
      { img: "images/photo6.jpg", text: "–°–ø–∞—Å–∏–±–æ" }
    ];

    // === –≠–ª–µ–º–µ–Ω—Ç—ã ===
    const music = document.getElementById("music");

    const startScreen = document.getElementById("startScreen");
    const slideScreen = document.getElementById("slideScreen");
    const finalScreen = document.getElementById("finalScreen");

    const startBtn = document.getElementById("startBtn");
    const hint = document.getElementById("hint");

    const slideImage = document.getElementById("slideImage");
    const slideText = document.getElementById("slideText");
    const progress = document.getElementById("progress");

    const toggleSoundBtn = document.getElementById("toggleSoundBtn");
    const skipBtn = document.getElementById("skipBtn");

    const collage = document.getElementById("collage");
    const hugBtn = document.getElementById("hugBtn");
    const hugText = document.getElementById("hugText");

    const modal = document.getElementById("modal");
    const modalImg = document.getElementById("modalImg");
    const closeModalBtn = document.getElementById("closeModalBtn");

    // === –°–æ—Å—Ç–æ—è–Ω–∏–µ ===
    let started = false;
    let index = 0;
    let timer = null;

    // 20 —Å–µ–∫—É–Ω–¥ –Ω–∞ –≤—Å—ë (–∫–∞–∫ —É —Ç–µ–±—è), –Ω–æ –º–æ–∂–Ω–æ –ø–æ–º–µ–Ω—è—Ç—å
    const totalTime = 30000;
    const slideTime = Math.round(totalTime / slides.length);

    // === –£—Ç–∏–ª–∏—Ç—ã ===
    function show(el){ el.classList.remove("hidden"); }
    function hide(el){ el.classList.add("hidden"); }

    function fadeInAudio(audio, ms = 900, target = 1.0){
      audio.volume = 0.0;
      const steps = 30;
      let i = 0;
      const t = setInterval(() => {
        i++;
        audio.volume = Math.min(target, (i/steps) * target);
        if (i >= steps) clearInterval(t);
      }, ms/steps);
    }

    function setSoundButton(){
      toggleSoundBtn.textContent = music.muted ? "üîá –ó–≤—É–∫" : "üîä –ó–≤—É–∫";
    }

    async function preloadSlides(){
      // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞: –Ω–∞ 5–ú–ë —Ñ–æ—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç—è–∂–µ–ª–æ, –Ω–æ –ª—É—á—à–µ —Ç–∞–∫, —á–µ–º –ª–∞–≥–∏ –ø–æ —Ö–æ–¥—É.
      // –ï—Å–ª–∏ –±—É–¥–µ—Ç —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ ‚Äî –º–æ–∂–Ω–æ –≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–≤—ã–µ 2-3, –∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ –º–µ—Ä–µ –ø–æ–∫–∞–∑–∞.
      const tasks = slides.map(s => new Promise(res => {
        const im = new Image();
        im.onload = () => res(true);
        im.onerror = () => res(false);
        im.src = s.img;
      }));
      await Promise.all(tasks);
    }

    // === –°–ª–∞–π–¥—à–æ—É ===
    function renderSlide(i){
      const s = slides[i];
      progress.textContent = `${i+1} / ${slides.length}`;

      slideImage.classList.add("fade");
      // –Ω–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã fade —É—Å–ø–µ–ª –Ω–∞—á–∞—Ç—å—Å—è
      setTimeout(() => {
        slideImage.alt = s.text;
        slideText.textContent = s.text;

        // –°–º–µ–Ω–∞ src
        slideImage.src = s.img;

        // –£–±–∏—Ä–∞–µ–º fade –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ (–∏–ª–∏ —á–µ—Ä–µ–∑ —Ç–∞–π–º–∞—É—Ç –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)
        let done = false;
        const finish = () => {
          if (done) return;
          done = true;
          slideImage.classList.remove("fade");
        };
        slideImage.onload = finish;
        setTimeout(finish, 600);
      }, 220);
    }

    function nextSlide(){
      if (index >= slides.length){
        endShow();
        return;
      }
      renderSlide(index);
      index++;
      timer = setTimeout(nextSlide, slideTime);
    }

    function endShow(){
      if (timer) clearTimeout(timer);
      hide(slideScreen);
      show(finalScreen);
      buildCollage();
    }

    function buildCollage(){
      collage.innerHTML = "";
      slides.forEach((s) => {
        const img = document.createElement("img");
        img.src = s.img;
        img.alt = s.text;
        img.loading = "lazy";
        img.decoding = "async";
        img.addEventListener("click", () => openModal(s.img, s.text));
        collage.appendChild(img);
      });
    }

    // === –ú–æ–¥–∞–ª–∫–∞ ===
    function openModal(src, alt){
      modalImg.src = src;
      modalImg.alt = alt || "–§–æ—Ç–æ";
      modal.classList.add("show");
      modal.setAttribute("aria-hidden", "false");
    }
    function closeModal(){
      modal.classList.remove("show");
      modal.setAttribute("aria-hidden", "true");
      // –æ—á–∏—Å—Ç–∫–∞ src —á—É—Ç—å —Ä–∞–∑–≥—Ä—É–∂–∞–µ—Ç –ø–∞–º—è—Ç—å –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö
      setTimeout(() => { modalImg.src = ""; }, 150);
    }

    // === –ó–∞–ø—É—Å–∫ ===
    async function startShow(){
      if (started) return;
      started = true;

      hint.textContent = "–ó–∞–≥—Ä—É–∂–∞—é —Ñ–æ—Ç–æ‚Ä¶";

      // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ: –ø—Ä–æ–±—É–µ–º —Å—Ç–∞—Ä—Ç–∞–Ω—É—Ç—å –º—É–∑—ã–∫—É –∏ –≥—Ä—É–∑–∏–º —Ñ–æ—Ç–æ
      // –ú—É–∑—ã–∫–∞ –Ω–∞ iPhone –¥–æ–ª–∂–Ω–∞ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å —Å—Ç—Ä–æ–≥–æ –æ—Ç –∂–µ—Å—Ç–∞ ‚Äî –º—ã –≤–Ω—É—Ç—Ä–∏ –∫–ª–∏–∫–∞, –æ–∫.
      try{
        music.muted = false;
        setSoundButton();
        await music.play();
        fadeInAudio(music, 900, 1.0);
      } catch (e){
        // –ï—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –∑–∞–ø—Ä–µ—Ç–∏–ª ‚Äî –Ω–µ –ª–æ–º–∞–µ–º –ø–æ–∫–∞–∑, –ø—Ä–æ—Å—Ç–æ –±–µ–∑ –º—É–∑—ã–∫–∏
        hint.textContent = "–ï—Å–ª–∏ –∑–≤—É–∫ –Ω–µ –≤–∫–ª—é—á–∏–ª—Å—è ‚Äî –Ω–∞–∂–º–∏ ¬´üîä –ó–≤—É–∫¬ª –ø–æ–∑–∂–µ.";
      }

      await preloadSlides();

      hint.textContent = "";
      hide(startScreen);
      show(slideScreen);

      index = 0;
      nextSlide();
    }

    // === –°–µ—Ä–¥–µ—á–∫–∏ (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ) ===
    const reduceMotion = window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;
    let heartsCount = 0;
    const HEARTS_LIMIT = 18;

    function createHeart(){
      if (reduceMotion) return;
      if (document.hidden) return;
      if (heartsCount >= HEARTS_LIMIT) return;

      heartsCount++;
      const heart = document.createElement("div");
      heart.className = "heart";
      heart.textContent = "‚ù§Ô∏è";
      heart.style.left = (Math.random() * 100) + "vw";
      heart.style.fontSize = (12 + Math.random() * 18) + "px";
      heart.style.animationDuration = (8 + Math.random() * 7) + "s";
      document.body.appendChild(heart);

      const life = 16000;
      setTimeout(() => {
        heart.remove();
        heartsCount--;
      }, life);
    }
    setInterval(createHeart, 1100);

    // –°–µ—Ä–¥–µ—á–∫–∏ –ø–æ —Ç–∞–ø—É (–ª—É—á—à–µ pointerdown, —á–µ–º click)
    document.addEventListener("pointerdown", (e) => {
      if (reduceMotion) return;
      // –Ω–µ —Ä–∏—Å—É–µ–º —Å–µ—Ä–¥–µ—á–∫–æ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏/–º–æ–¥–∞–ª–∫—É
      const tag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : "";
      if (tag === "button") return;
      if (modal.classList.contains("show")) return;

      const h = document.createElement("div");
      h.className = "tap-heart";
      h.textContent = "‚ù§Ô∏è";
      h.style.left = e.clientX + "px";
      h.style.top = e.clientY + "px";
      document.body.appendChild(h);
      setTimeout(() => h.remove(), 1700);
    }, { passive: true });

    // === –°–æ–±—ã—Ç–∏—è ===
    startBtn.addEventListener("click", startShow);

    toggleSoundBtn.addEventListener("click", async () => {
      // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å mute + –ø–æ–ø—ã—Ç–∫–∞ play –µ—Å–ª–∏ –±—ã–ª–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
      music.muted = !music.muted;
      setSoundButton();
      if (!music.muted){
        try{
          await music.play();
        } catch(e){}
      }
    });

    skipBtn.addEventListener("click", endShow);

    hugBtn.addEventListener("click", () => {
      hugText.textContent = "–°—Ä–æ—á–Ω–æ –Ω—É–∂–Ω–æ –æ–±–Ω—è—Ç—å —Å–≤–æ–µ–≥–æ –ö–æ—Ç—ë–º–∏–∫–∞ üêæ‚ù§Ô∏è";
    });

    closeModalBtn.addEventListener("click", closeModal);
    modal.addEventListener("click", (e) => {
      if (e.target === modal) closeModal();
    });

    document.addEventListener("visibilitychange", () => {
      // –µ—Å–ª–∏ –≤–∫–ª–∞–¥–∫–∞ —Å–∫—Ä—ã—Ç–∞ ‚Äî —Å—Ç–∞–≤–∏–º –º—É–∑—ã–∫—É –Ω–∞ –ø–∞—É–∑—É (–º–µ–Ω—å—à–µ –≥–ª—é–∫–æ–≤ –Ω–∞ iOS)
      if (document.hidden){
        try{ music.pause(); } catch(e){}
      }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –∑–≤—É–∫–∞
    setSoundButton();
  </script>
</body>
</html>

